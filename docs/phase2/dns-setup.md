# Phase 2, –≠—Ç–∞–ø 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

–î–∞—Ç–∞: 2025-11-19

## üìã DNS –∑–∞–ø–∏—Å–∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –¢—Ä–µ–±—É–µ–º—ã–µ DNS –∑–∞–ø–∏—Å–∏

1. **app.staging.betaserver.ru** ‚Üí `62.76.233.233`
   - –î–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   - –¢–∏–ø: A
   - TTL: 300 (–∏–ª–∏ –º–µ–Ω—å—à–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)

2. **staging.betaserver.ru** ‚Üí `62.76.233.233`
   - –î–ª—è –ª–µ–Ω–¥–∏–Ω–≥–∞
   - –¢–∏–ø: A
   - TTL: 300 (–∏–ª–∏ –º–µ–Ω—å—à–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)

---

## üîß –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ DNS

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è DNS

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è DNS –¥–ª—è –¥–æ–º–µ–Ω–∞ `betaserver.ru`
2. –ù–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª "DNS –∑–∞–ø–∏—Å–∏" –∏–ª–∏ "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ DNS"
3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å —Ç–∏–ø–∞ **A**:

   **–î–ª—è app.staging.betaserver.ru:**
   - **–ò–º—è/–•–æ—Å—Ç:** `app.staging`
   - **–¢–∏–ø:** A
   - **–ó–Ω–∞—á–µ–Ω–∏–µ/IP:** `62.76.233.233`
   - **TTL:** 300

   **–î–ª—è staging.betaserver.ru:**
   - **–ò–º—è/–•–æ—Å—Ç:** `staging` (–∏–ª–∏ `@` –¥–ª—è –∫–æ—Ä–Ω–µ–≤–æ–≥–æ –¥–æ–º–µ–Ω–∞)
   - **–¢–∏–ø:** A
   - **–ó–Ω–∞—á–µ–Ω–∏–µ/IP:** `62.76.233.233`
   - **TTL:** 300

4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ Timeweb Cloud API

Timeweb Cloud API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ DNS –Ω–∞–ø—Ä—è–º—É—é, –ø–æ—ç—Ç–æ–º—É –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DNS, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ app.staging.betaserver.ru
dig +short app.staging.betaserver.ru
# –û–∂–∏–¥–∞–µ—Ç—Å—è: 62.76.233.233

# –ü—Ä–æ–≤–µ—Ä–∫–∞ staging.betaserver.ru
dig +short staging.betaserver.ru
# –û–∂–∏–¥–∞–µ—Ç—Å—è: 62.76.233.233

# –ò–ª–∏ —á–µ—Ä–µ–∑ nslookup
nslookup app.staging.betaserver.ru
nslookup staging.betaserver.ru
```

---

## üîí TLS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DNS, cert-manager –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

1. –°–æ–∑–¥–∞—Å—Ç HTTP-01 challenge
2. –ü–æ–ª—É—á–∏—Ç TLS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –æ—Ç Let's Encrypt
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤ Kubernetes Secret

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤:**

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ Certificate —Ä–µ—Å—É—Ä—Å–æ–≤
kubectl get certificates -n maratea

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Secret'–æ–≤ —Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏
kubectl get secrets -n maratea | grep tls

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ Certificate
kubectl describe certificate app-tls -n maratea
kubectl describe certificate landing-tls -n maratea
```

---

## üåê –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DNS –∏ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤:

1. **App:**
   ```bash
   curl -I https://app.staging.betaserver.ru
   # –û–∂–∏–¥–∞–µ—Ç—Å—è: HTTP/2 200
   ```

2. **Landing:**
   ```bash
   curl -I https://staging.betaserver.ru
   # –û–∂–∏–¥–∞–µ—Ç—Å—è: HTTP/2 200
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ TLS:**
   ```bash
   openssl s_client -connect app.staging.betaserver.ru:443 -servername app.staging.betaserver.ru
   openssl s_client -connect staging.betaserver.ru:443 -servername staging.betaserver.ru
   ```

---

## ‚è±Ô∏è –í—Ä–µ–º—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è DNS

- **–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ:** 1-5 –º–∏–Ω—É—Ç (–ø—Ä–∏ TTL=300)
- **–û–±—ã—á–Ω–æ–µ:** 5-15 –º–∏–Ω—É—Ç
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ:** –¥–æ 24 —á–∞—Å–æ–≤ (–µ—Å–ª–∏ —Å—Ç–∞—Ä—ã–π TTL –±—ã–ª –±–æ–ª—å—à–∏–º)

–ü–æ—Å–ª–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è DNS, cert-manager –ø–æ–ª—É—á–∏—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –≤ —Ç–µ—á–µ–Ω–∏–µ 1-2 –º–∏–Ω—É—Ç.

---

## üìù –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

- ‚úÖ Ingress –¥–ª—è `app` —Å–æ–∑–¥–∞–Ω
- ‚úÖ Ingress –¥–ª—è `landing` —Å–æ–∑–¥–∞–Ω
- ‚úÖ Certificate —Ä–µ—Å—É—Ä—Å—ã —Å–æ–∑–¥–∞–Ω—ã
- ‚è≥ DNS –∑–∞–ø–∏—Å–∏ —Ç—Ä–µ–±—É—é—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–≤—Ä—É—á–Ω—É—é)
- ‚è≥ TLS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –±—É–¥—É—Ç –ø–æ–ª—É—á–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ DNS

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Ingress –¥–ª—è app](../infrastructure/kubernetes/app/ingress.yaml)
- [Ingress –¥–ª—è landing](../infrastructure/kubernetes/landing/ingress.yaml)
- [Certificate –¥–ª—è app](../infrastructure/kubernetes/app/certificate.yaml)
- [Certificate –¥–ª—è landing](../infrastructure/kubernetes/landing/certificate.yaml)

