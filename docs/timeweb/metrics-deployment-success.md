# –ú–µ—Ç—Ä–∏–∫–∏ Prometheus - –î–µ–ø–ª–æ–π —É—Å–ø–µ—à–µ–Ω ‚úÖ

–î–∞—Ç–∞: 2025-11-18

## ‚úÖ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω

### –°—Ç–∞—Ç—É—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

- ‚úÖ **GitHub Actions** - –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞ —É—Å–ø–µ—à–Ω–∞
- ‚úÖ **ArgoCD** - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞
- ‚úÖ **API Gateway** - –ù–æ–≤—ã–π –æ–±—Ä–∞–∑ –∑–∞–¥–µ–ø–ª–æ–µ–Ω
- ‚úÖ **–ú–µ—Ç—Ä–∏–∫–∏ Prometheus** - –î–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ `/metrics`

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫

### 1. Endpoint /metrics

```bash
kubectl port-forward -n maratea svc/api-gateway 8080:8080
curl http://localhost:8080/metrics
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ú–µ—Ç—Ä–∏–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Prometheus
- `http_requests_total`
- `http_request_duration_seconds`
- `process_memory_usage_bytes`
- –ò –¥—Ä—É–≥–∏–µ –º–µ—Ç—Ä–∏–∫–∏

### 2. Prometheus Targets

```bash
kubectl port-forward -n observability svc/monitoring-kube-prometheus-prometheus 9090:9090
# –û—Ç–∫—Ä—ã—Ç—å http://localhost:9090/targets
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- `api-gateway` target –≤ —Å—Ç–∞—Ç—É—Å–µ `up`
- –ú–µ—Ç—Ä–∏–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è —É—Å–ø–µ—à–Ω–æ

### 3. Prometheus Queries

```promql
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
up{job="api-gateway"}

# –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
sum(rate(http_requests_total[5m])) by (method, status_code)

# 95-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞
histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))

# –ß–∞—Å—Ç–æ—Ç–∞ –æ—à–∏–±–æ–∫
sum(rate(http_request_errors_total[5m])) by (error_type)
```

---

## üéØ –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

### HTTP –º–µ—Ç—Ä–∏–∫–∏
- `http_request_duration_seconds` - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- `http_requests_total` - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
- `http_request_errors_total` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫

### Proxy –º–µ—Ç—Ä–∏–∫–∏
- `proxy_request_duration_seconds` - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å proxy –∑–∞–ø—Ä–æ—Å–æ–≤
- `proxy_requests_total` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ proxy –∑–∞–ø—Ä–æ—Å–æ–≤

### Circuit Breaker –º–µ—Ç—Ä–∏–∫–∏
- `circuit_breaker_state` - —Å–æ—Å—Ç–æ—è–Ω–∏–µ circuit breaker
- `circuit_breaker_failures_total` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–±–æ–µ–≤

### Process –º–µ—Ç—Ä–∏–∫–∏
- `process_memory_usage_bytes` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –∞–ª–µ—Ä—Ç–æ–≤

Prometheus Rules –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏ –∞–∫—Ç–∏–≤–Ω—ã:

- `APIGatewayDown` - —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, –µ—Å–ª–∏ API Gateway –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- `APIGatewayHighLatency` - —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–µ
- `APIGatewayHighErrorRate` - —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π —á–∞—Å—Ç–æ—Ç–µ –æ—à–∏–±–æ–∫

–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ Prometheus UI:
- –û—Ç–∫—Ä—ã—Ç—å http://localhost:9090/rules
- –ù–∞–π—Ç–∏ –≥—Ä—É–ø–ø—É `maratea-alerts`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø—Ä–∞–≤–∏–ª

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ú–µ—Ç—Ä–∏–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã
2. ‚úÖ Prometheus —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏
3. ‚úÖ –ê–ª–µ—Ä—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
4. ‚è≥ –°–æ–∑–¥–∞—Ç—å Grafana dashboards –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
5. ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–ª–µ—Ä—Ç—ã

---

## üéâ Phase 1 –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à–µ–Ω–∞!

**–í—Å–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã:**
- ‚úÖ DNS –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ S3 Backup –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ Telegram webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ Prometheus –º–µ—Ç—Ä–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –ê–ª–µ—Ä—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ

