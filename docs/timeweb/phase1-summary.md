# Phase 1: –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞

–î–∞—Ç–∞: 2025-11-18

## ‚úÖ –ß—Ç–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (100%)
- ‚úÖ Kubernetes –∫–ª–∞—Å—Ç–µ—Ä Timeweb Cloud –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ Namespace `maratea` —Å–æ–∑–¥–∞–Ω
- ‚úÖ PostgreSQL —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Redis —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ API Gateway —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ `api.staging.betaserver.ru`
- ‚úÖ Network Policies –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

### CI/CD (100%)
- ‚úÖ GitHub Actions workflow —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—è Docker –æ–±—Ä–∞–∑–æ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –≤ –∫–ª–∞—Å—Ç–µ—Ä
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ Observability (100%)
- ‚úÖ Prometheus —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏
- ‚úÖ Grafana —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –¥–∞—à–±–æ—Ä–¥–∞–º–∏
- ‚úÖ Loki —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ª–æ–≥–æ–≤
- ‚úÖ Promtail —Å–æ–±–∏—Ä–∞–µ—Ç –ª–æ–≥–∏ —Å–æ –≤—Å–µ—Ö nodes
- ‚úÖ Alertmanager –Ω–∞—Å—Ç—Ä–æ–µ–Ω

### Backup (90%)
- ‚úÖ PostgreSQL backup CronJob —Å–æ–∑–¥–∞–Ω (–ª–æ–∫–∞–ª—å–Ω—ã–π)
- ‚úÖ PostgreSQL backup —Å S3 –º–∞–Ω–∏—Ñ–µ—Å—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω
- ‚úÖ Redis backup CronJob —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚è≥ S3 secret —Ç—Ä–µ–±—É–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã–º–∏ credentials

### –ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø (90%)
- ‚úÖ Ingress –¥–ª—è API Gateway —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Ingress –¥–ª—è ArgoCD —Å–æ–∑–¥–∞–Ω
- ‚úÖ Ingress –¥–ª—è Grafana —Å–æ–∑–¥–∞–Ω
- ‚úÖ Certificate —Ä–µ—Å—É—Ä—Å—ã —Å–æ–∑–¥–∞–Ω—ã
- ‚è≥ DNS –∑–∞–ø–∏—Å–∏ —Ç—Ä–µ–±—É—é—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –ê–ª–µ—Ä—Ç–∏–Ω–≥ (80%)
- ‚úÖ Alertmanager –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
- ‚úÖ Webhook –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- ‚è≥ Webhook URL'—ã —Ç—Ä–µ–±—É—é—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

---

## ‚è≥ –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (20 –º–∏–Ω—É—Ç)

### 1. DNS –∑–∞–ø–∏—Å–∏ (5 –º–∏–Ω—É—Ç)

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è DNS –¥–ª—è `betaserver.ru`
2. –°–æ–∑–¥–∞–π—Ç–µ 2 A –∑–∞–ø–∏—Å–∏:
   - `argocd.staging` ‚Üí `62.76.233.233`
   - `grafana.staging` ‚Üí `62.76.233.233`

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
dig +short argocd.staging.betaserver.ru
dig +short grafana.staging.betaserver.ru
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DNS cert-manager –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∏—Ç TLS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã.

---

### 2. S3 Backup (10 –º–∏–Ω—É—Ç)

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –°–æ–∑–¥–∞–π—Ç–µ S3 bucket –≤ Timeweb Cloud (`maratea-backups`)
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç:
   ```bash
   kubectl edit secret s3-backup-secret -n maratea
   ```
3. –ó–∞–º–µ–Ω–∏—Ç–µ placeholder –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ credentials

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
kubectl create job --from=cronjob/postgres-backup-s3 postgres-backup-test-$(date +%s) -n maratea
kubectl logs -n maratea job/postgres-backup-test-<timestamp>
```

---

### 3. Webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (5 –º–∏–Ω—É—Ç)

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –°–æ–∑–¥–∞–π—Ç–µ Slack webhook –∏–ª–∏ Telegram bot
2. –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:
   ```bash
   kubectl edit secret alertmanager-config -n observability
   ```
3. –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ webhook URL

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# Port-forward –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ alert
kubectl port-forward -n observability svc/alertmanager-monitoring-kube-prometheus-alertmanager 9093:9093
curl -X POST http://localhost:9093/api/v1/alerts -d '[{"labels":{"alertname":"Test"}}]'
```

---

## üìä –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å Phase 1

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ü—Ä–æ–≥—Ä–µ—Å—Å |
|-----------|--------|----------|
| –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ | ‚úÖ | 100% |
| CI/CD | ‚úÖ | 100% |
| –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ | ‚úÖ | 100% |
| –õ–æ–≥–∏ | ‚úÖ | 100% |
| –ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø | ‚è≥ | 90% (—Ç—Ä–µ–±—É–µ—Ç DNS) |
| Backup | ‚è≥ | 90% (—Ç—Ä–µ–±—É–µ—Ç S3 credentials) |
| –ê–ª–µ—Ä—Ç–∏–Ω–≥ | ‚è≥ | 80% (—Ç—Ä–µ–±—É–µ—Ç webhook URL) |

**–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å Phase 1: 94%**

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã

```bash
export KUBECONFIG=/path/to/twc-cute-grosbeak-config.yaml

# 1. DNS (–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏)
./scripts/setup-dns-argocd-grafana.sh

# 2. S3 Backup (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π)
./scripts/setup-s3-backup.sh

# 3. Webhook (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π)
./scripts/setup-webhook-alerts.sh

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞
./scripts/complete-phase1-setup.sh
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –°–ª–µ–¥–æ–≤–∞—Ç—å —á–µ–∫-–ª–∏—Å—Ç—É

–û—Ç–∫—Ä–æ–π—Ç–µ `docs/timeweb/manual-setup-checklist.md` –∏ —Å–ª–µ–¥—É–π—Ç–µ –ø–æ—à–∞–≥–æ–≤—ã–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º.

---

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

1. **–°–∫—Ä–∏–ø—Ç—ã:**
   - `scripts/setup-dns-argocd-grafana.sh` - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ DNS
   - `scripts/setup-s3-backup.sh` - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ S3
   - `scripts/setup-webhook-alerts.sh` - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ webhook'–æ–≤
   - `scripts/complete-phase1-setup.sh` - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
   - `scripts/auto-setup-phase1.sh` - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–≤

2. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
   - `docs/timeweb/phase1-complete.md` - –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç
   - `docs/timeweb/phase1-final-status.md` - –§–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å
   - `docs/timeweb/phase1-summary.md` - –≠—Ç–æ—Ç —Ñ–∞–π–ª
   - `docs/timeweb/manual-setup-checklist.md` - –ß–µ–∫-–ª–∏—Å—Ç
   - `docs/timeweb/s3-backup-setup.md` - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ S3
   - `docs/timeweb/webhook-setup.md` - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ webhook'–∞–º

---

## üéØ –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Phase 1

Phase 1 –±—É–¥–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –Ω–∞ 100%, –∏ –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫:

1. **Phase 2: –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π**
   - Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (app, landing)
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CI/CD –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
   - –ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º

2. **Phase 3: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤**
   - auth-service
   - organization-service
   - user-service
   - –∏ –¥—Ä.

3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**
   - HPA (–∞–≤—Ç–æ–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ)
   - –ö–∞—Å—Ç–æ–º–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥—ã Grafana
   - Distributed tracing

---

## üí° –°–æ–≤–µ—Ç—ã

- **DNS:** –ù–∞—Å—Ç—Ä–æ–π—Ç–µ DNS –∫–∞–∫ –º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ, —á—Ç–æ–±—ã cert-manager –º–æ–≥ –ø–æ–ª—É—á–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
- **S3 Backup:** –ù–∞—Å—Ç—Ä–æ–π—Ç–µ backup –ø–µ—Ä–µ–¥ production –¥–∞–Ω–Ω—ã–º–∏
- **Webhook:** –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–±–ª–µ–º

–í—Å–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≥–æ—Ç–æ–≤—ã. –û—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å 3 –ø—Ä–æ—Å—Ç—ã–µ –∑–∞–¥–∞—á–∏!

