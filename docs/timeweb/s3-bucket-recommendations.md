# –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤—ã–±–æ—Ä—É S3 Bucket –¥–ª—è Backup'–æ–≤

–î–∞—Ç–∞: 2025-11-18

## üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è backup'–æ–≤

### ‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**1. –ö–ª–∞—Å—Å —Ö—Ä–∞–Ω–µ–Ω–∏—è (Storage Class):**
- ‚úÖ **–í—ã–±–µ—Ä–∏—Ç–µ: "–•–æ–ª–æ–¥–Ω—ã–π" (Cold)**
- ‚ùå –ù–µ –≤—ã–±–∏—Ä–∞–π—Ç–µ: "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π" (Standard)

**–ü–æ—á–µ–º—É:**
- Backup'—ã - —ç—Ç–æ —Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏)
- "–•–æ–ª–æ–¥–Ω—ã–π" –∫–ª–∞—Å—Å –¥–µ—à–µ–≤–ª–µ –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è
- –û–ø–∏—Å–∞–Ω–∏–µ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ: "–û–ø—Ç–∏–º–∞–ª–µ–Ω –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –≤–∫–ª—é—á–∞—è —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –∏ –∞—Ä—Ö–∏–≤—ã"

**2. –¢–∏–ø (Type):**
- ‚úÖ **–í—ã–±–µ—Ä–∏—Ç–µ: "–ü—Ä–∏–≤–∞—Ç–Ω—ã–π" (Private)**
- ‚ùå –ù–µ –≤—ã–±–∏—Ä–∞–π—Ç–µ: "–ü—É–±–ª–∏—á–Ω—ã–π" (Public)

**–ü–æ—á–µ–º—É:**
- Backup'—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, –ø–∞—Ä–æ–ª–∏)
- –ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ backup'–∞–º - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –î–æ—Å—Ç—É–ø –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Access Keys

**3. –†–µ–≥–∏–æ–Ω (Region):**
- ‚úÖ **–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥** (—É–∂–µ –≤—ã–±—Ä–∞–Ω–æ)
- –≠—Ç–æ —Ä–µ–≥–∏–æ–Ω `ru-1`, –∫–æ—Ç–æ—Ä—ã–π —É–∫–∞–∑–∞–Ω –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**4. –û–±—ä–µ–º —Ö—Ä–∞–Ω–µ–Ω–∏—è (Storage Volume):**
- ‚úÖ **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: 500-1000 –ì–ë** (–º–æ–∂–Ω–æ –Ω–∞—á–∞—Ç—å —Å –º–µ–Ω—å—à–µ–≥–æ)
- ‚ùå –ù–µ –Ω—É–∂–Ω–æ: 2000 –ì–ë —Å—Ä–∞–∑—É

**–ü–æ—á–µ–º—É:**
- Backup'—ã —Å–∂–∏–º–∞—é—Ç—Å—è (gzip), –ø–æ—ç—Ç–æ–º—É —Ä–µ–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –º–µ–Ω—å—à–µ
- PostgreSQL backup: ~50-200 –ú–ë –≤ —Å–∂–∞—Ç–æ–º –≤–∏–¥–µ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ë–î)
- Redis backup: ~10-50 –ú–ë –≤ —Å–∂–∞—Ç–æ–º –≤–∏–¥–µ
- –ú–æ–∂–Ω–æ –Ω–∞—á–∞—Ç—å —Å 500 –ì–ë –∏ —É–≤–µ–ª–∏—á–∏—Ç—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- –°—Ç–∞—Ä—ã–µ backup'—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ 30 –¥–Ω–µ–π

**5. –•—Ä–∞–Ω–∏–ª–∏—â–µ (Storage):**
- ‚úÖ **"–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–µ" (Arbitrary)** - —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è
- ‚ùå "–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ" (Fixed) - –ø–ª–∞—Ç–∏—Ç–µ –∑–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–æ–µ –º–µ—Å—Ç–æ

**–ü–æ—á–µ–º—É:**
- –ü–ª–∞—Ç–∏—Ç–µ —Ç–æ–ª—å–∫–æ –∑–∞ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ –º–µ—Å—Ç–æ
- Backup'—ã —Ä–∞—Å—Ç—É—Ç –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ
- –≠–∫–æ–Ω–æ–º–∏—è —Å—Ä–µ–¥—Å—Ç–≤

---

## üìä –ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á–µ—Ç–∞ –æ–±—ä–µ–º–∞

**PostgreSQL backup:**
- –†–∞–∑–º–µ—Ä –ë–î: ~10 –ì–ë
- –°–∂–∞—Ç—ã–π backup: ~1-2 –ì–ë
- –•—Ä–∞–Ω–µ–Ω–∏–µ 30 –¥–Ω–µ–π: ~30-60 –ì–ë

**Redis backup:**
- –†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö: ~1 –ì–ë
- –°–∂–∞—Ç—ã–π backup: ~100-200 –ú–ë
- –•—Ä–∞–Ω–µ–Ω–∏–µ 7 –¥–Ω–µ–π: ~1-2 –ì–ë

**–ò—Ç–æ–≥–æ:**
- –ú–∏–Ω–∏–º—É–º: ~50-100 –ì–ë
- –° –∑–∞–ø–∞—Å–æ–º: 500 –ì–ë
- –î–ª—è —Ä–æ—Å—Ç–∞: 1000 –ì–ë

---

## üí∞ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏

**"–•–æ–ª–æ–¥–Ω—ã–π" –∫–ª–∞—Å—Å (Cold):**
- –î–µ—à–µ–≤–ª–µ –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è
- –û–ø—Ç–∏–º–∞–ª–µ–Ω –¥–ª—è backup'–æ–≤

**"–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π" –∫–ª–∞—Å—Å (Standard):**
- –î–æ—Ä–æ–∂–µ
- –î–ª—è —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ù–µ –Ω—É–∂–µ–Ω –¥–ª—è backup'–æ–≤

**–≠–∫–æ–Ω–æ–º–∏—è:** –ü—Ä–∏ –≤—ã–±–æ—Ä–µ "–•–æ–ª–æ–¥–Ω–æ–≥–æ" –∫–ª–∞—Å—Å–∞ –º–æ–∂–Ω–æ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –¥–æ 50% –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–∏.

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

1. ‚úÖ **–¢–∏–ø: –ü—Ä–∏–≤–∞—Ç–Ω—ã–π** - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!
2. ‚úÖ **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:** –í–∫–ª—é—á–∏—Ç—å (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)
3. ‚úÖ **Access Keys:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ (—Ç–æ–ª—å–∫–æ –∑–∞–ø–∏—Å—å/—á—Ç–µ–Ω–∏–µ –≤ bucket)
4. ‚úÖ **Lifecycle Policy:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö backup'–æ–≤

---

## üìã –ò—Ç–æ–≥–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ S3 Bucket      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –†–µ–≥–∏–æ–Ω: –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥ (ru-1)         ‚îÇ
‚îÇ –ö–ª–∞—Å—Å —Ö—Ä–∞–Ω–µ–Ω–∏—è: –•–æ–ª–æ–¥–Ω—ã–π (Cold)        ‚îÇ
‚îÇ –¢–∏–ø: –ü—Ä–∏–≤–∞—Ç–Ω—ã–π (Private)            ‚îÇ
‚îÇ –•—Ä–∞–Ω–∏–ª–∏—â–µ: –ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–µ (Arbitrary)    ‚îÇ
‚îÇ –û–±—ä–µ–º: 500-1000 –ì–ë                     ‚îÇ
‚îÇ –ò–º—è: maratea-backups                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è bucket:

1. **–ó–∞–ø–∏—à–∏—Ç–µ credentials:**
   - Access Key ID
   - Secret Access Key
   - Endpoint: `s3.timeweb.cloud`
   - Region: `ru-1`
   - Bucket name: `maratea-backups`

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–µ–∫—Ä–µ—Ç –≤ Kubernetes:**
   ```bash
   kubectl edit secret s3-backup-secret -n maratea
   ```

3. **–ü—Ä–∏–º–µ–Ω–∏—Ç–µ backup CronJob:**
   ```bash
   kubectl apply -f infrastructure/kubernetes/postgres/backup-cronjob-s3.yaml
   ```

4. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ backup:**
   ```bash
   kubectl create job --from=cronjob/postgres-backup-s3 postgres-backup-test-$(date +%s) -n maratea
   kubectl logs -n maratea job/postgres-backup-test-<timestamp>
   ```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ù–µ –≤—ã–±–∏—Ä–∞–π—Ç–µ "–ü—É–±–ª–∏—á–Ω—ã–π" —Ç–∏–ø** - —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
2. **–ù–∞—á–Ω–∏—Ç–µ —Å –º–µ–Ω—å—à–µ–≥–æ –æ–±—ä–µ–º–∞** (500 –ì–ë) - –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –ø–æ–∑–∂–µ
3. **–í—ã–±–µ—Ä–∏—Ç–µ "–•–æ–ª–æ–¥–Ω—ã–π" –∫–ª–∞—Å—Å** - –¥–µ—à–µ–≤–ª–µ –¥–ª—è backup'–æ–≤
4. **–í–∫–ª—é—á–∏—Ç–µ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ª—É—á–∞–π–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
5. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ "–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–µ" —Ö—Ä–∞–Ω–∏–ª–∏—â–µ** - –ø–ª–∞—Ç–∏—Ç–µ —Ç–æ–ª—å–∫–æ –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–æ–µ –º–µ—Å—Ç–æ

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `docs/timeweb/s3-backup-setup.md` - –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
- `infrastructure/kubernetes/postgres/backup-cronjob-s3.yaml` - –ú–∞–Ω–∏—Ñ–µ—Å—Ç backup
- `infrastructure/kubernetes/backup/s3-secret.yaml` - –®–∞–±–ª–æ–Ω —Å–µ–∫—Ä–µ—Ç–∞

