# –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ S3 Backup

–î–∞—Ç–∞: 2025-11-18

## ‚úÖ –£—Å–ø–µ—à–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### Backup –∑–∞–≥—Ä—É–∂–µ–Ω –≤ S3

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
upload: tmp/postgres-backup-20251118-204221.sql.gz to s3://af0d31be-cb217873-8a91-4500-9782-12793c7d715d/postgres/postgres-backup-20251118-204221.sql.gz
Backup uploaded to S3 successfully
Backup process completed at Tue Nov 18 20:44:33 UTC 2025
```

**Job —Å—Ç–∞—Ç—É—Å:** ‚úÖ `Complete 1/1`

**–§–∞–π–ª –≤ S3:**
- Bucket: `af0d31be-cb217873-8a91-4500-9782-12793c7d715d`
- –ü—É—Ç—å: `postgres/postgres-backup-20251118-204221.sql.gz`
- –†–∞–∑–º–µ—Ä: 20 Bytes (4.0K –¥–æ —Å–∂–∞—Ç–∏—è)

## ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ PostgreSQL:**
```
pg_dump: error: connection to server at "postgres" (10.110.93.53), port 5432 failed: Operation timed out
```

**–ü—Ä–∏—á–∏–Ω–∞:** –í–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–æ–±–ª–µ–º–∞ —Å Network Policy –∏–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å PostgreSQL.

**–†–µ—à–µ–Ω–∏–µ:** Backup –≤—Å–µ —Ä–∞–≤–Ω–æ —Å–æ–∑–¥–∞–ª—Å—è (–ø—É—Å—Ç–æ–π —Ñ–∞–π–ª) –∏ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è –≤ S3. –î–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ backup'–∞ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL.

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **S3 —Å–µ–∫—Ä–µ—Ç:** ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
   - Endpoint: `s3.twcstorage.ru`
   - Bucket: `af0d31be-cb217873-8a91-4500-9782-12793c7d715d`
   - Access Key –∏ Secret Key: –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

2. **Backup –ø—Ä–æ—Ü–µ—Å—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
   - awscli —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
   - Backup —Å–æ–∑–¥–∞–µ—Ç—Å—è
   - –ó–∞–≥—Ä—É–∑–∫–∞ –≤ S3 —Ä–∞–±–æ—Ç–∞–µ—Ç
   - –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö backup'–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç

3. **CronJob:** ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω
   - –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ: –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2:00 UTC
   - –ì–æ—Ç–æ–≤ –∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é

## üìä –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å |
|-----------|--------|
| S3 —Å–µ–∫—Ä–µ—Ç | ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω |
| Backup —Å–æ–∑–¥–∞–Ω–∏–µ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| –ó–∞–≥—Ä—É–∑–∫–∞ –≤ S3 | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| PostgreSQL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ | ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ |
| CronJob | ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω |

## üîß –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Network Policy
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ PostgreSQL –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ service `postgres` –¥–æ—Å—Ç—É–ø–µ–Ω

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å backup –≤ S3:**
   ```bash
   aws --endpoint-url=https://s3.twcstorage.ru s3 ls s3://af0d31be-cb217873-8a91-4500-9782-12793c7d715d/postgres/
   ```

3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:**
   - –°–∫–∞—á–∞—Ç—å backup –∏–∑ S3
   - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ —Ç–µ—Å—Ç–æ–≤—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

## ‚úÖ –í—ã–≤–æ–¥

**S3 backup –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç!** 

Backup —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ S3. –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL, –∫–æ—Ç–æ—Ä–æ–µ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –¥–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã—Ö backup'–æ–≤ —Å –¥–∞–Ω–Ω—ã–º–∏.

